{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Gorkem.Cadirci\\\\talep-sistemi\\\\src\\\\pages\\\\TeamMonitor.js\",\n  _s = $RefreshSig$();\n// src/pages/TeamMonitor.jsx\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport supabase from \"../supabaseClient\";\nimport \"./Inbox.css\"; // mevcut stillerden yararlanıyoruz\n\n/* ---- Sabitler ---- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst STATUS = {\n  Yeni: \"Yeni\",\n  SirayaAlindi: \"SirayaAlindi\",\n  IslemeAlindi: \"IslemeAlindi\",\n  TestEdiliyor: \"TestEdiliyor\",\n  Tamamlandi: \"Tamamlandi\"\n};\nconst STATUS_DISPLAY = {\n  [STATUS.Yeni]: \"Yeni\",\n  [STATUS.SirayaAlindi]: \"Sıraya Alındı\",\n  [STATUS.IslemeAlindi]: \"İşleme Alındı\",\n  [STATUS.TestEdiliyor]: \"Test Ediliyor\",\n  [STATUS.Tamamlandi]: \"Tamamlandı\"\n};\nconst BOARD_COLUMNS = [{\n  key: STATUS.Yeni,\n  title: STATUS_DISPLAY[STATUS.Yeni]\n}, {\n  key: STATUS.SirayaAlindi,\n  title: STATUS_DISPLAY[STATUS.SirayaAlindi]\n}, {\n  key: STATUS.IslemeAlindi,\n  title: STATUS_DISPLAY[STATUS.IslemeAlindi]\n}, {\n  key: STATUS.TestEdiliyor,\n  title: STATUS_DISPLAY[STATUS.TestEdiliyor]\n}, {\n  key: STATUS.Tamamlandi,\n  title: STATUS_DISPLAY[STATUS.Tamamlandi]\n}];\n\n// İzlenecek kullanıcılar\nconst MONITORED_USERS = [{\n  name: \"GÖRKEM ÇADIRCI\"\n}, {\n  name: \"FURKAN BİLGİLİ\"\n}, {\n  name: \"YAĞIZ EFE BULUTCU\"\n}];\n\n// Bu sayfayı görebilecek kişi\nconst ALLOWED_VIEWER = \"ONUR KEREM ÖZTÜRK\";\n\n/* ---- Utils ---- */\nfunction slug(s) {\n  return (s || \"\").toLowerCase().replaceAll(\"ı\", \"i\").replaceAll(\"ğ\", \"g\").replaceAll(\"ş\", \"s\").replaceAll(\"ö\", \"o\").replaceAll(\"ç\", \"c\").replaceAll(\"ü\", \"u\").replace(/\\s+/g, \"-\");\n}\nfunction fmtTime(ts) {\n  try {\n    return new Date(ts).toLocaleString();\n  } catch {\n    return \"—\";\n  }\n}\nfunction dateNum(v) {\n  try {\n    return new Date(v).getTime() || 0;\n  } catch {\n    return 0;\n  }\n}\nfunction sortByKanbanOrder(list) {\n  const a = [...(list || [])];\n  a.sort((x, y) => {\n    var _x$kolon_sira, _y$kolon_sira, _x$id, _y$id;\n    const kx = (_x$kolon_sira = x.kolon_sira) !== null && _x$kolon_sira !== void 0 ? _x$kolon_sira : 1e15;\n    const ky = (_y$kolon_sira = y.kolon_sira) !== null && _y$kolon_sira !== void 0 ? _y$kolon_sira : 1e15;\n    if (kx !== ky) return kx - ky;\n    const tx = dateNum(y.guncelleme_tarihi) - dateNum(x.guncelleme_tarihi);\n    if (tx !== 0) return tx;\n    return ((_x$id = x.id) !== null && _x$id !== void 0 ? _x$id : 0) - ((_y$id = y.id) !== null && _y$id !== void 0 ? _y$id : 0);\n  });\n  return a;\n}\nexport default function TeamMonitor() {\n  _s();\n  const navigate = useNavigate();\n\n  // login + yetki kontrolü\n  const me = useMemo(() => {\n    try {\n      return JSON.parse(localStorage.getItem(\"user_profile\") || \"{}\");\n    } catch {\n      return {};\n    }\n  }, []);\n  const myName = ((me === null || me === void 0 ? void 0 : me.kullanici) || \"\").trim();\n  useEffect(() => {\n    if (!localStorage.getItem(\"auth_token\")) {\n      navigate(\"/login\", {\n        replace: true\n      });\n      return;\n    }\n  }, [navigate]);\n  const canView = useMemo(() => {\n    const up = (myName || \"\").toLocaleUpperCase(\"tr-TR\");\n    return up === ALLOWED_VIEWER;\n  }, [myName]);\n  const [q, setQ] = useState(\"\");\n  const [onlySLA, setOnlySLA] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState(\"\");\n  const [rows, setRows] = useState([]);\n\n  // data fetch\n  useEffect(() => {\n    if (!canView) return;\n    fetchData();\n    // eslint-disable-next-line\n  }, [onlySLA]);\n\n  // realtime\n  useEffect(() => {\n    if (!canView) return;\n    const ch = supabase.channel(\"talepler-realtime-monitor\").on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"talepler\"\n    }, payload => {\n      setRows(prev => applyRealtime(prev, payload));\n    }).subscribe();\n    return () => supabase.removeChannel(ch);\n  }, [canView]);\n  async function fetchData() {\n    try {\n      setLoading(true);\n      setErr(\"\");\n      const names = MONITORED_USERS.map(u => u.name);\n      let query = supabase.from(\"talepler\").select(\"*\").in(\"atanan_kullanici\", names);\n      if (onlySLA) {\n        const t24 = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\n        query = query.lt(\"sla_son_tarih\", t24).not(\"durum\", \"in\", '(\"Tamamlandi\",\"Reddedildi\")');\n      }\n\n      // Kanban’da tutarlı görünüm için kolon_sira + güncelleme_tarihi\n      query = query.order(\"kolon_sira\", {\n        ascending: true,\n        nullsFirst: true\n      }).order(\"guncelleme_tarihi\", {\n        ascending: false\n      }).limit(1000);\n      const {\n        data,\n        error\n      } = await query;\n      if (error) throw error;\n      setRows(sortByKanbanOrder(data || []));\n    } catch (e) {\n      console.error(e);\n      setErr(\"Kayıtlar çekilemedi.\");\n    } finally {\n      setLoading(false);\n    }\n  }\n  function applyRealtime(prev, payload) {\n    const next = [...prev];\n    if (payload.eventType === \"DELETE\") {\n      return next.filter(r => {\n        var _payload$old;\n        return r.id !== ((_payload$old = payload.old) === null || _payload$old === void 0 ? void 0 : _payload$old.id);\n      });\n    }\n    const row = payload.new;\n    // Sadece izlenen kullanıcılar\n    if (!MONITORED_USERS.some(u => u.name === (row === null || row === void 0 ? void 0 : row.atanan_kullanici))) return prev;\n    const i = next.findIndex(r => r.id === row.id);\n    if (i === -1) next.push(row);else next[i] = {\n      ...next[i],\n      ...row\n    };\n    return sortByKanbanOrder(next);\n  }\n\n  // filtreleme\n  const filtered = rows.filter(r => {\n    if (!q) return true;\n    const text = `${r.id} ${r.baslik} ${r.talep_eden_email} ${r.atanan_email || \"\"} ${r.talep_eden_kullanici || \"\"} ${r.atanan_kullanici || \"\"}`.toLowerCase();\n    return text.includes(q.toLowerCase());\n  });\n\n  // kullanıcı -> status -> items\n  const byUser = useMemo(() => {\n    const map = new Map();\n    MONITORED_USERS.forEach(u => {\n      map.set(u.name, Object.fromEntries(BOARD_COLUMNS.map(c => [c.key, []])));\n    });\n    for (const r of filtered) {\n      const user = r.atanan_kullanici;\n      if (!map.has(user)) continue;\n      const k = r.durum || STATUS.Yeni;\n      map.get(user)[k].push(r);\n    }\n    // iç listeleri sırala\n    for (const [, colMap] of map) {\n      for (const k of Object.keys(colMap)) {\n        colMap[k] = sortByKanbanOrder(colMap[k]);\n      }\n    }\n    return map;\n  }, [filtered]);\n  if (!canView) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mx\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mx-top\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"brand\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"logo\",\n            children: \"\\uD83D\\uDC40\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bt\",\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              children: \"Takip Ekran\\u0131\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 45\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"muted\",\n              children: \"Eri\\u015Fim yetkiniz yok\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 66\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mx-alert err\",\n        children: [\"Bu ekran yaln\\u0131zca \", /*#__PURE__*/_jsxDEV(\"b\", {\n          children: ALLOWED_VIEWER\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 65\n        }, this), \" i\\xE7in yetkilidir.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"mx\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mx-top\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"brand\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"logo\",\n          children: \"\\uD83D\\uDCCA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bt\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"Takip Ekran\\u0131\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"muted\",\n            children: \"G\\xD6RKEM \\u2022 FURKAN \\u2022 YA\\u011EIZ \\u2014 canl\\u0131 durum\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cmd\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"search-wrap\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"search\",\n            placeholder: \"Ara: #id, ba\\u015Fl\\u0131k, ki\\u015Fi\\u2026\",\n            value: q,\n            onChange: e => setQ(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"toggles\",\n          children: /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"toggle\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: onlySLA,\n              onChange: e => setOnlySLA(e.target.checked)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"SLA (<24s)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn ghost\",\n          onClick: fetchData,\n          children: \"Yenile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn primary\",\n          onClick: () => navigate(\"/inbox\"),\n          children: \"Benim Inbox\\u2019\\u0131m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }, this), err && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mx-alert err\",\n      children: err\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 21\n    }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mx-skel\",\n      children: \"Y\\xFCkleniyor\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 25\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"board\",\n      style: {\n        gap: 8,\n        marginTop: 8\n      },\n      children: MONITORED_USERS.map(u => {\n        const cols = byUser.get(u.name);\n        const total = cols ? Object.values(cols).reduce((n, arr) => n + arr.length, 0) : 0;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          style: {\n            minWidth: 320\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-head\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"dot\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: u.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"count\",\n              children: total\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-body\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"board\",\n              style: {\n                gridTemplateColumns: `repeat(${BOARD_COLUMNS.length}, minmax(220px,1fr))`,\n                gap: 8\n              },\n              children: BOARD_COLUMNS.map(col => {\n                const items = (cols === null || cols === void 0 ? void 0 : cols[col.key]) || [];\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"col\",\n                  style: {\n                    minWidth: 220\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"col-head\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: `dot s-${slug(col.title)}`\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 258,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n                      style: {\n                        margin: 0\n                      },\n                      children: col.title\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 259,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"count\",\n                      children: items.length\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 260,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 257,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"col-body\",\n                    children: [items.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"col-empty\",\n                      children: \"Yok\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 263,\n                      columnNumber: 76\n                    }, this), items.slice(0, 6).map(item => /*#__PURE__*/_jsxDEV(\"button\", {\n                      className: `card ${item.durum === STATUS.Tamamlandi ? \"mine\" : \"\"}`,\n                      style: {\n                        textAlign: \"left\",\n                        cursor: \"pointer\"\n                      },\n                      onClick: () => navigate(`/inbox?assignee=${encodeURIComponent(item.atanan_email || \"\")}`),\n                      title: `#${item.id} — ${item.baslik}\\nGüncellenme: ${fmtTime(item.guncelleme_tarihi)}`,\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"c-title\",\n                        children: [\"#\", item.id, \" \\u2014 \", item.baslik]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 272,\n                        columnNumber: 61\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"c-desc\",\n                        style: {\n                          opacity: 0.8\n                        },\n                        children: item.talep_eden_kullanici || item.talep_eden_email || \"—\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 273,\n                        columnNumber: 61\n                      }, this)]\n                    }, item.id, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 265,\n                      columnNumber: 57\n                    }, this)), items.length > 6 && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"muted\",\n                      style: {\n                        marginTop: 6\n                      },\n                      children: [\"+\", items.length - 6, \" daha\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 279,\n                      columnNumber: 57\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 262,\n                    columnNumber: 49\n                  }, this)]\n                }, col.key, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 45\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 29\n          }, this)]\n        }, u.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 25\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"muted\",\n      style: {\n        marginTop: 8\n      },\n      children: [\"Kartlara t\\u0131klay\\u0131nca ilgili ki\\u015Finin inbox\\u2019\\u0131na gidersin (URL\\u2019de \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"assignee\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 79\n      }, this), \" parametresiyle).\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 199,\n    columnNumber: 9\n  }, this);\n}\n_s(TeamMonitor, \"bW77jFV/gqwkSZR+Vd06OtTzt0E=\", false, function () {\n  return [useNavigate];\n});\n_c = TeamMonitor;\nvar _c;\n$RefreshReg$(_c, \"TeamMonitor\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","useNavigate","supabase","jsxDEV","_jsxDEV","STATUS","Yeni","SirayaAlindi","IslemeAlindi","TestEdiliyor","Tamamlandi","STATUS_DISPLAY","BOARD_COLUMNS","key","title","MONITORED_USERS","name","ALLOWED_VIEWER","slug","s","toLowerCase","replaceAll","replace","fmtTime","ts","Date","toLocaleString","dateNum","v","getTime","sortByKanbanOrder","list","a","sort","x","y","_x$kolon_sira","_y$kolon_sira","_x$id","_y$id","kx","kolon_sira","ky","tx","guncelleme_tarihi","id","TeamMonitor","_s","navigate","me","JSON","parse","localStorage","getItem","myName","kullanici","trim","canView","up","toLocaleUpperCase","q","setQ","onlySLA","setOnlySLA","loading","setLoading","err","setErr","rows","setRows","fetchData","ch","channel","on","event","schema","table","payload","prev","applyRealtime","subscribe","removeChannel","names","map","u","query","from","select","in","t24","now","toISOString","lt","not","order","ascending","nullsFirst","limit","data","error","e","console","next","eventType","filter","r","_payload$old","old","row","new","some","atanan_kullanici","i","findIndex","push","filtered","text","baslik","talep_eden_email","atanan_email","talep_eden_kullanici","includes","byUser","Map","forEach","set","Object","fromEntries","c","user","has","k","durum","get","colMap","keys","className","children","fileName","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","target","type","checked","onClick","style","gap","marginTop","cols","total","values","reduce","n","arr","length","minWidth","gridTemplateColumns","col","items","margin","slice","item","textAlign","cursor","encodeURIComponent","opacity","_c","$RefreshReg$"],"sources":["C:/Users/Gorkem.Cadirci/talep-sistemi/src/pages/TeamMonitor.js"],"sourcesContent":["// src/pages/TeamMonitor.jsx\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport supabase from \"../supabaseClient\";\r\nimport \"./Inbox.css\"; // mevcut stillerden yararlanıyoruz\r\n\r\n/* ---- Sabitler ---- */\r\nconst STATUS = {\r\n    Yeni: \"Yeni\",\r\n    SirayaAlindi: \"SirayaAlindi\",\r\n    IslemeAlindi: \"IslemeAlindi\",\r\n    TestEdiliyor: \"TestEdiliyor\",\r\n    Tamamlandi: \"Tamamlandi\",\r\n};\r\n\r\nconst STATUS_DISPLAY = {\r\n    [STATUS.Yeni]: \"Yeni\",\r\n    [STATUS.SirayaAlindi]: \"Sıraya Alındı\",\r\n    [STATUS.IslemeAlindi]: \"İşleme Alındı\",\r\n    [STATUS.TestEdiliyor]: \"Test Ediliyor\",\r\n    [STATUS.Tamamlandi]: \"Tamamlandı\",\r\n};\r\n\r\nconst BOARD_COLUMNS = [\r\n    { key: STATUS.Yeni, title: STATUS_DISPLAY[STATUS.Yeni] },\r\n    { key: STATUS.SirayaAlindi, title: STATUS_DISPLAY[STATUS.SirayaAlindi] },\r\n    { key: STATUS.IslemeAlindi, title: STATUS_DISPLAY[STATUS.IslemeAlindi] },\r\n    { key: STATUS.TestEdiliyor, title: STATUS_DISPLAY[STATUS.TestEdiliyor] },\r\n    { key: STATUS.Tamamlandi, title: STATUS_DISPLAY[STATUS.Tamamlandi] },\r\n];\r\n\r\n// İzlenecek kullanıcılar\r\nconst MONITORED_USERS = [\r\n    { name: \"GÖRKEM ÇADIRCI\" },\r\n    { name: \"FURKAN BİLGİLİ\" },\r\n    { name: \"YAĞIZ EFE BULUTCU\" },\r\n];\r\n\r\n// Bu sayfayı görebilecek kişi\r\nconst ALLOWED_VIEWER = \"ONUR KEREM ÖZTÜRK\";\r\n\r\n/* ---- Utils ---- */\r\nfunction slug(s) {\r\n    return (s || \"\")\r\n        .toLowerCase()\r\n        .replaceAll(\"ı\", \"i\").replaceAll(\"ğ\", \"g\").replaceAll(\"ş\", \"s\")\r\n        .replaceAll(\"ö\", \"o\").replaceAll(\"ç\", \"c\").replaceAll(\"ü\", \"u\")\r\n        .replace(/\\s+/g, \"-\");\r\n}\r\nfunction fmtTime(ts) { try { return new Date(ts).toLocaleString(); } catch { return \"—\"; } }\r\nfunction dateNum(v) { try { return new Date(v).getTime() || 0; } catch { return 0; } }\r\n\r\nfunction sortByKanbanOrder(list) {\r\n    const a = [...(list || [])];\r\n    a.sort((x, y) => {\r\n        const kx = x.kolon_sira ?? 1e15;\r\n        const ky = y.kolon_sira ?? 1e15;\r\n        if (kx !== ky) return kx - ky;\r\n        const tx = dateNum(y.guncelleme_tarihi) - dateNum(x.guncelleme_tarihi);\r\n        if (tx !== 0) return tx;\r\n        return (x.id ?? 0) - (y.id ?? 0);\r\n    });\r\n    return a;\r\n}\r\n\r\nexport default function TeamMonitor() {\r\n    const navigate = useNavigate();\r\n\r\n    // login + yetki kontrolü\r\n    const me = useMemo(() => {\r\n        try { return JSON.parse(localStorage.getItem(\"user_profile\") || \"{}\"); }\r\n        catch { return {}; }\r\n    }, []);\r\n    const myName = (me?.kullanici || \"\").trim();\r\n    useEffect(() => {\r\n        if (!localStorage.getItem(\"auth_token\")) {\r\n            navigate(\"/login\", { replace: true });\r\n            return;\r\n        }\r\n    }, [navigate]);\r\n    const canView = useMemo(() => {\r\n        const up = (myName || \"\").toLocaleUpperCase(\"tr-TR\");\r\n        return up === ALLOWED_VIEWER;\r\n    }, [myName]);\r\n\r\n    const [q, setQ] = useState(\"\");\r\n    const [onlySLA, setOnlySLA] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [err, setErr] = useState(\"\");\r\n    const [rows, setRows] = useState([]);\r\n\r\n    // data fetch\r\n    useEffect(() => {\r\n        if (!canView) return;\r\n        fetchData();\r\n        // eslint-disable-next-line\r\n    }, [onlySLA]);\r\n\r\n    // realtime\r\n    useEffect(() => {\r\n        if (!canView) return;\r\n        const ch = supabase\r\n            .channel(\"talepler-realtime-monitor\")\r\n            .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"talepler\" }, (payload) => {\r\n                setRows((prev) => applyRealtime(prev, payload));\r\n            })\r\n            .subscribe();\r\n        return () => supabase.removeChannel(ch);\r\n    }, [canView]);\r\n\r\n    async function fetchData() {\r\n        try {\r\n            setLoading(true);\r\n            setErr(\"\");\r\n\r\n            const names = MONITORED_USERS.map(u => u.name);\r\n            let query = supabase.from(\"talepler\").select(\"*\").in(\"atanan_kullanici\", names);\r\n\r\n            if (onlySLA) {\r\n                const t24 = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\r\n                query = query.lt(\"sla_son_tarih\", t24).not(\"durum\", \"in\", '(\"Tamamlandi\",\"Reddedildi\")');\r\n            }\r\n\r\n            // Kanban’da tutarlı görünüm için kolon_sira + güncelleme_tarihi\r\n            query = query\r\n                .order(\"kolon_sira\", { ascending: true, nullsFirst: true })\r\n                .order(\"guncelleme_tarihi\", { ascending: false })\r\n                .limit(1000);\r\n\r\n            const { data, error } = await query;\r\n            if (error) throw error;\r\n            setRows(sortByKanbanOrder(data || []));\r\n        } catch (e) {\r\n            console.error(e);\r\n            setErr(\"Kayıtlar çekilemedi.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    function applyRealtime(prev, payload) {\r\n        const next = [...prev];\r\n        if (payload.eventType === \"DELETE\") {\r\n            return next.filter(r => r.id !== payload.old?.id);\r\n        }\r\n        const row = payload.new;\r\n        // Sadece izlenen kullanıcılar\r\n        if (!MONITORED_USERS.some(u => u.name === row?.atanan_kullanici)) return prev;\r\n\r\n        const i = next.findIndex(r => r.id === row.id);\r\n        if (i === -1) next.push(row);\r\n        else next[i] = { ...next[i], ...row };\r\n        return sortByKanbanOrder(next);\r\n    }\r\n\r\n    // filtreleme\r\n    const filtered = rows.filter((r) => {\r\n        if (!q) return true;\r\n        const text = `${r.id} ${r.baslik} ${r.talep_eden_email} ${r.atanan_email || \"\"} ${r.talep_eden_kullanici || \"\"} ${r.atanan_kullanici || \"\"}`.toLowerCase();\r\n        return text.includes(q.toLowerCase());\r\n    });\r\n\r\n    // kullanıcı -> status -> items\r\n    const byUser = useMemo(() => {\r\n        const map = new Map();\r\n        MONITORED_USERS.forEach(u => {\r\n            map.set(u.name, Object.fromEntries(BOARD_COLUMNS.map(c => [c.key, []])));\r\n        });\r\n        for (const r of filtered) {\r\n            const user = r.atanan_kullanici;\r\n            if (!map.has(user)) continue;\r\n            const k = r.durum || STATUS.Yeni;\r\n            map.get(user)[k].push(r);\r\n        }\r\n        // iç listeleri sırala\r\n        for (const [, colMap] of map) {\r\n            for (const k of Object.keys(colMap)) {\r\n                colMap[k] = sortByKanbanOrder(colMap[k]);\r\n            }\r\n        }\r\n        return map;\r\n    }, [filtered]);\r\n\r\n    if (!canView) {\r\n        return (\r\n            <div className=\"mx\">\r\n                <div className=\"mx-top\">\r\n                    <div className=\"brand\">\r\n                        <div className=\"logo\">👀</div>\r\n                        <div className=\"bt\"><h1>Takip Ekranı</h1><span className=\"muted\">Erişim yetkiniz yok</span></div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"mx-alert err\">Bu ekran yalnızca <b>{ALLOWED_VIEWER}</b> için yetkilidir.</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"mx\">\r\n            <div className=\"mx-top\">\r\n                <div className=\"brand\">\r\n                    <div className=\"logo\">📊</div>\r\n                    <div className=\"bt\">\r\n                        <h1>Takip Ekranı</h1>\r\n                        <span className=\"muted\">GÖRKEM • FURKAN • YAĞIZ — canlı durum</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"cmd\">\r\n                    <div className=\"search-wrap\">\r\n                        <input\r\n                            className=\"search\"\r\n                            placeholder=\"Ara: #id, başlık, kişi…\"\r\n                            value={q}\r\n                            onChange={(e) => setQ(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className=\"toggles\">\r\n                        <label className=\"toggle\">\r\n                            <input type=\"checkbox\" checked={onlySLA} onChange={(e) => setOnlySLA(e.target.checked)} />\r\n                            <span>SLA (&lt;24s)</span>\r\n                        </label>\r\n                    </div>\r\n                    <button className=\"btn ghost\" onClick={fetchData}>Yenile</button>\r\n                    <button\r\n                        className=\"btn primary\"\r\n                        onClick={() => navigate(\"/inbox\")}\r\n                    >\r\n                        Benim Inbox’ım\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {err && <div className=\"mx-alert err\">{err}</div>}\r\n            {loading && <div className=\"mx-skel\">Yükleniyor…</div>}\r\n\r\n            {/* Özet barı */}\r\n            <div className=\"board\" style={{ gap: 8, marginTop: 8 }}>\r\n                {MONITORED_USERS.map(u => {\r\n                    const cols = byUser.get(u.name);\r\n                    const total = cols ? Object.values(cols).reduce((n, arr) => n + arr.length, 0) : 0;\r\n                    return (\r\n                        <div key={u.name} className=\"col\" style={{ minWidth: 320 }}>\r\n                            <div className=\"col-head\">\r\n                                <span className=\"dot\"></span>\r\n                                <h3>{u.name}</h3>\r\n                                <span className=\"count\">{total}</span>\r\n                            </div>\r\n\r\n                            <div className=\"col-body\">\r\n                                {/* Her kullanıcı için yatay mini-kanban */}\r\n                                <div className=\"board\" style={{ gridTemplateColumns: `repeat(${BOARD_COLUMNS.length}, minmax(220px,1fr))`, gap: 8 }}>\r\n                                    {BOARD_COLUMNS.map(col => {\r\n                                        const items = cols?.[col.key] || [];\r\n                                        return (\r\n                                            <div key={col.key} className=\"col\" style={{ minWidth: 220 }}>\r\n                                                <div className=\"col-head\">\r\n                                                    <span className={`dot s-${slug(col.title)}`}></span>\r\n                                                    <h4 style={{ margin: 0 }}>{col.title}</h4>\r\n                                                    <span className=\"count\">{items.length}</span>\r\n                                                </div>\r\n                                                <div className=\"col-body\">\r\n                                                    {items.length === 0 && <div className=\"col-empty\">Yok</div>}\r\n                                                    {items.slice(0, 6).map(item => (\r\n                                                        <button\r\n                                                            key={item.id}\r\n                                                            className={`card ${item.durum === STATUS.Tamamlandi ? \"mine\" : \"\"}`}\r\n                                                            style={{ textAlign: \"left\", cursor: \"pointer\" }}\r\n                                                            onClick={() => navigate(`/inbox?assignee=${encodeURIComponent(item.atanan_email || \"\")}`)}\r\n                                                            title={`#${item.id} — ${item.baslik}\\nGüncellenme: ${fmtTime(item.guncelleme_tarihi)}`}\r\n                                                        >\r\n                                                            <div className=\"c-title\">#{item.id} — {item.baslik}</div>\r\n                                                            <div className=\"c-desc\" style={{ opacity: 0.8 }}>\r\n                                                                {item.talep_eden_kullanici || item.talep_eden_email || \"—\"}\r\n                                                            </div>\r\n                                                        </button>\r\n                                                    ))}\r\n                                                    {items.length > 6 && (\r\n                                                        <div className=\"muted\" style={{ marginTop: 6 }}>\r\n                                                            +{items.length - 6} daha\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            <div className=\"muted\" style={{ marginTop: 8 }}>\r\n                Kartlara tıklayınca ilgili kişinin inbox’ına gidersin (URL’de <code>assignee</code> parametresiyle).\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}